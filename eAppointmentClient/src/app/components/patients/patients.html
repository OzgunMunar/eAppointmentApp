<div class="mt-2 d-flex justify-content-between align-items-center">

    <h3>Patients Page</h3>

    <nav style="--bs-breadcrumb-divider: '>';" aria-label="breadcrumb">
        <ol class="breadcrumb">
            <li class="breadcrumb-item"><a routerLink="/">Home</a></li>
            <li class="breadcrumb-item active">Patient List</li>
        </ol>
    </nav>

</div>

<div class="mt-3">
    <div class="form-group">

        <flexi-grid [data]="data()" [showCaption]="true" captionTitle="Patients List" [showExportExcelBtn]="true"
            language="en" exportExcelFileName="Patients" (onrefresh)="patients.reload()">

            <ng-template flexiGridCaptionCommandTemplate>
                <flexi-button btnIcon="add" btnColor="primary" title="Add Patient" (click)="openAddModal()"
                    flexiTooltip/>
            </ng-template>

            <flexi-grid-column field="fullName" title="Full Name" />
            <flexi-grid-column field="email" title="Email" />
            <flexi-grid-column field="phoneNumber" title="Phone Number" />
            <flexi-grid-column field="street" title="Street" />
            <flexi-grid-column field="city" title="City" />
            <flexi-grid-column field="country" title="Country" />

            <ng-template flexiGridColumnCommandTemplate let-item>

                <flexi-button 
                    btnIcon="edit" 
                    btnColor="info" 
                    title="Edit Patient Info" 
                    btnSize="small" 
                    (click)="openUpdateModal(item.id)"
                    flexiTooltip />

                <flexi-button 
                    (click)="deletePatient(item.id, item.fullName)"
                    cancelBtnText="Cancel"
                    btnIcon="delete" 
                    btnColor="danger" 
                    title="Delete Patient" 
                    btnSize="small" 
                    flexiTooltip />

            </ng-template>

        </flexi-grid>


    </div>
</div>

<!-- Create Modal -->
<div #addModal class="modal fade" id="addModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h1 class="modal-title fs-5">Add Patient Form</h1>
            </div>

            <form formValidate #form="ngForm" (ngSubmit)="savePatient(form)" autocomplete="off">

                <div class="modal-body">

                    <div class="form-group">

                        <label>First Name:</label>
                        <input #addFirstInput type="text" [(ngModel)]="newPatient().firstName" name="firstName"
                            class="form-control" minlength="3" required>
                        <div class="invalid-feedback">First Name is required.</div>
                    </div>

                    <div class="form-group mt-3">

                        <label>Last Name:</label>
                        <input type="text" [(ngModel)]="newPatient().lastName" name="lastName" class="form-control"
                            minlength="3" required>
                        <div class="invalid-feedback">Last Name is required.</div>
                    </div>

                    <div class="form-group mt-3">

                        <label>Identity Number:</label>
                        <input type="text" [(ngModel)]="newPatient().identityNumber" name="identityNumber"
                            class="form-control" minlength="11" maxlength="11" required>
                        <div class="invalid-feedback">Identity Number(11 character) is required.</div>

                    </div>

                    <div class="form-group mt-3">

                        <label>Email:</label>
                        <input type="email" [(ngModel)]="newPatient().email" name="email" class="form-control"
                            minlength="3" required>
                        <div class="invalid-feedback">Email is required.</div>

                    </div>

                    <div class="form-group mt-3">

                        <label>Phone Number:</label>
                        <input type="text" [(ngModel)]="newPatient().phoneNumber" name="phoneNumber" class="form-control"
                            minlength="3" required>
                        <div class="invalid-feedback">Phone number is required.</div>

                    </div>

                    <div class="form-group mt-3">

                        <label>Country:</label>
                        <input type="text" [(ngModel)]="newPatient().country" name="country" class="form-control"
                            minlength="3" required>
                        <div class="invalid-feedback">Country is required.</div>

                    </div>

                    <div class="form-group mt-3">

                        <label>City:</label>
                        <input type="text" [(ngModel)]="newPatient().city" name="city" class="form-control" minlength="3"
                            required>
                        <div class="invalid-feedback">City is required.</div>

                    </div>

                    <div class="form-group mt-3">

                        <label>Street:</label>
                        <input type="text" [(ngModel)]="newPatient().street" name="street" class="form-control"
                            minlength="3" required>
                        <div class="invalid-feedback">Street is required.</div>

                    </div>

                </div>

                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="submit" class="btn btn-primary">Save Patient</button>
                </div>

            </form>

        </div>
    </div>
</div>

<!-- Update Modal -->
<div #updateModal class="modal fade" id="updateModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h1 class="modal-title fs-5">Update Patient Form</h1>
            </div>

            <form formValidate #form="ngForm" 
                (ngSubmit)="updatePatient(form)" autocomplete="off">

                <div class="modal-body">

                    <div class="form-group">

                        <label>First Name:</label>
                        <input #updateFirstInput type="text" 
                            [(ngModel)]="updatePatientValues().firstName" name="firstName"
                            class="form-control" minlength="3" required>
                        <div class="invalid-feedback">First Name is required.</div>
                    </div>

                    <div class="form-group mt-3">

                        <label>Last Name:</label>
                        <input type="text" 
                            [(ngModel)]="updatePatientValues().lastName" name="lastName" class="form-control"
                            minlength="3" required>
                        <div class="invalid-feedback">Last Name is required.</div>
                    </div>

                    <div class="form-group mt-3">

                        <label>Identity Number:</label>
                        <input type="text" 
                            [(ngModel)]="updatePatientValues().identityNumber" name="identityNumber"
                            class="form-control" minlength="11" maxlength="11" required>
                        <div class="invalid-feedback">Identity Number(11 character) is required.</div>

                    </div>

                    <div class="form-group mt-3">

                        <label>Email:</label>
                        <input type="email" 
                            [(ngModel)]="updatePatientValues().email" name="email" class="form-control"
                            minlength="3" required>
                        <div class="invalid-feedback">Email is required.</div>

                    </div>

                    <div class="form-group mt-3">

                        <label>Phone Number:</label>
                        <input type="text" 
                            [(ngModel)]="updatePatientValues().phoneNumber" name="phoneNumber" class="form-control"
                            minlength="3" required>
                        <div class="invalid-feedback">Phone number is required.</div>

                    </div>

                    <div class="form-group mt-3">

                        <label>Country:</label>
                        <input type="text" 
                            [(ngModel)]="updatePatientValues().country" name="country" class="form-control"
                            minlength="3" required>
                        <div class="invalid-feedback">Country is required.</div>

                    </div>

                    <div class="form-group mt-3">

                        <label>City:</label>
                        <input type="text" 
                            [(ngModel)]="updatePatientValues().city" name="city" class="form-control" minlength="3"
                            required>
                        <div class="invalid-feedback">City is required.</div>

                    </div>

                    <div class="form-group mt-3">

                        <label>Street:</label>
                        <input type="text" 
                            [(ngModel)]="updatePatientValues().street" name="street" class="form-control"
                            minlength="3" required>
                        <div class="invalid-feedback">Street is required.</div>

                    </div>

                </div>

                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="submit" class="btn btn-info">Update Patient</button>
                </div>

            </form>

        </div>
    </div>
</div>
